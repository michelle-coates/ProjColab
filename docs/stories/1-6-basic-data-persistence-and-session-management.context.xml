<?xml version="1.0" encoding="UTF-8"?>
<story>
    <metadata>
        <id>1.6</id>
        <title>Basic Data Persistence and Session Management</title>
        <type>feature</type>
        <priority>high</priority>
        <effort>medium-large</effort>
        <status>ready-for-dev</status>
        <epic>1</epic>
    </metadata>

    <references>
        <docs>
            <doc type="PRD" section="Functional Requirements">FR021</doc>
            <doc type="architecture">Data Persistence Layer</doc>
        </docs>
        <dependencies>
            <dependency type="story">1.1</dependency>
            <dependency type="story">1.2</dependency>
            <dependency type="story">1.3</dependency>
            <dependency type="story">1.4</dependency>
            <dependency type="story">1.5</dependency>
        </dependencies>
    </references>

    <business-value>
        <impact type="user-satisfaction">high</impact>
        <impact type="retention">medium</impact>
        <rationale>Essential feature for productive usage enabling work continuity across sessions</rationale>
    </business-value>

    <constraints>
        <constraint type="technical">Must support large datasets without performance degradation</constraint>
        <constraint type="security">Must ensure proper data isolation between users</constraint>
        <constraint type="ux">Auto-save must be non-intrusive but clear</constraint>
    </constraints>

    <implementation>
        <database>
            <model name="PrioritizationSession">
                <field name="id" type="uuid" primary="true"/>
                <field name="userId" type="uuid" foreign-key="users.id"/>
                <field name="name" type="string"/>
                <field name="status" type="enum">
                    <values>
                        <value>active</value>
                        <value>paused</value>
                        <value>completed</value>
                    </values>
                </field>
                <field name="createdAt" type="datetime"/>
                <field name="updatedAt" type="datetime"/>
                <field name="completedAt" type="datetime" nullable="true"/>
            </model>
            <relations>
                <relation type="one-to-many">
                    <from>User.id</from>
                    <to>PrioritizationSession.userId</to>
                </relation>
                <relation type="one-to-many">
                    <from>PrioritizationSession.id</from>
                    <to>Improvement.sessionId</to>
                </relation>
            </relations>
        </database>
        <api>
            <endpoint path="/api/sessions" method="GET">List user's sessions</endpoint>
            <endpoint path="/api/sessions" method="POST">Create new session</endpoint>
            <endpoint path="/api/sessions/:id" method="GET">Get session details</endpoint>
            <endpoint path="/api/sessions/:id" method="PATCH">Update session</endpoint>
            <endpoint path="/api/sessions/:id/state" method="GET">Get session state</endpoint>
            <endpoint path="/api/sessions/:id/state" method="POST">Update session state</endpoint>
        </api>
    </implementation>

    <testing>
        <scenario name="auto-save">
            <step>Make changes to improvement item</step>
            <step>Verify changes saved automatically</step>
            <step>Refresh page</step>
            <step>Verify changes persisted</step>
        </scenario>
        <scenario name="session-recovery">
            <step>Close browser during active session</step>
            <step>Reopen and authenticate</step>
            <step>Verify session state restored</step>
        </scenario>
    </testing>

    <artifacts>
        <code-files>
            <file path="/prisma/schema.prisma">Database schema updates</file>
            <file path="/src/server/api/routers/session.ts">Session management router</file>
            <file path="/src/components/PrioritizationSession">Session UI components</file>
        </code-files>
    </artifacts>
</story>